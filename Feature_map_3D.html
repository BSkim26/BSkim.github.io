<!--Copyright 2023 Kim Bumsoo-->

<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
    

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="Feature_map_3D/css/bootstrap.min.css">                <!--온라인 소스 가져오지 않도록 수정-->
    <link rel="stylesheet" href="Feature_map_3D/css/font.css" >
    <link type="text/css" rel="stylesheet" href="Feature_map_3D/css/text.css">
    <link type="text/css" rel="stylesheet" href="Feature_map_3D/css/Feature_map_3D.css">
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <style>
      canvas {
        border: 1px solid black;
      }
    </style>
    <title>Feature_map_3D</title>
    <script>
        function createBoxes() {
        var rows = document.getElementById("inputNumber0").value;
        var columns = document.getElementById("inputNumber1").value;
        var depths = document.getElementById("inputNumber2").value;


        var f_width = document.getElementById("FilterNumber0").value;
        var f_height = document.getElementById("FilterNumber1").value;
        var f_count = document.getElementById("FilterNumber2").value;

        var f_width1 = document.getElementById("FilterNumber1_0").value;
        var f_height1 = document.getElementById("FilterNumber1_1").value;
        var f_count1 = document.getElementById("FilterNumber1_2").value;

        var f_width2 = document.getElementById("FilterNumber2_0").value;
        var f_height2 = document.getElementById("FilterNumber2_1").value;
        var f_count2 = document.getElementById("FilterNumber2_2").value;

        var outputNumber = document.getElementById("outputNumber").value;
        let boxes = document.getElementById("boxes");
        var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        while (boxes.firstChild) {
      boxes.removeChild(boxes.firstChild);
    }
        
  for (let j = 0; j < depths; j++) {
    var box = document.createElement("div");
    box.classList.add("box");
    box.style.width = columns * 40 + "px";
    box.style.height = rows * 40 + "px";
    box.style.left = ((window.innerWidth / 7) + (5 * j)) + "px";
    box.style.top = ((window.innerHeight / 2- columns * 40/2) + (5 * j)) + "px";
    boxes.appendChild(box);
  }
  if((columns)>=(columns-f_height +1)){
    if((rows)>=(rows-f_width+1))
  for (let j = 0; j < f_count; j++) {
    var box = document.createElement("div");
    box.classList.add("box");
    box.style.width = (columns-f_height +1) * 40 + "px";
    box.style.height = (rows-f_width+1) * 40 + "px";
    box.style.left = ((window.innerWidth / 3.5) + (5 * j)) + "px";
    box.style.top = ((window.innerHeight / 2 - (rows-f_width+1) * 40/2) + (5 * j)) + "px";
    boxes.appendChild(box);
  }
}
  if((columns-f_height +1)>=f_height1){
    if((rows-f_width+1)>=((rows-f_width+1)-f_width1))
  for (let j = 0; j < f_count1; j++) {
    var box = document.createElement("div");
    box.classList.add("box");
    box.style.width = ((columns-f_height +1)-f_height1 +1) * 40 + "px";
    box.style.height = ((rows-f_width+1)-f_width1+1) * 40 + "px";
    box.style.left = ((window.innerWidth / 2.5) + (5 * j)) + "px";
    box.style.top = ((window.innerHeight / 2 - ((rows-f_width+1)-f_width1+1)*40/2) + (5 * j)) + "px";
    boxes.appendChild(box);
  }
}
  if(((columns-f_height +1)-f_height1 +1)>=f_height2){
    if(((rows-f_width+1)-f_width1+1)>=f_width2)
  for (let j = 0; j < f_count2; j++) {
    var box = document.createElement("div");
    box.classList.add("box");
    box.style.width = (((columns-f_height +1)-f_height1 +1)-f_height2 +1) * 40 + "px";
    box.style.height = (((rows-f_width+1)-f_width1+1)-f_width2+1) * 40 + "px";
    box.style.left = ((window.innerWidth /2) + (5 * j)) + "px";
    box.style.top = ((window.innerHeight / 2 - (((rows-f_width+1)-f_width1+1)-f_width2+1) * 40/2) + (5 * j)) + "px";
    boxes.appendChild(box);
  }
  }

  if(((columns-f_height +1)-f_height1 +1)>=f_height2){
    if(((rows-f_width+1)-f_width1+1)>=f_width2)
  for (let j = 0; j < (((columns-f_height +1)-f_height1 +1)-f_height2 +1)*(((rows-f_width+1)-f_width1+1)-f_width2+1); j++) {
    var box = document.createElement("div");
    box.classList.add("box");
    box.id = "box_" + j;
    box.style.borderRadius = "50%";
    box.style.width = 20 + "px";
    box.style.height = 20 + "px";
    box.style.left = (window.innerWidth /1.7) + "px";
    box.style.top = ((window.innerHeight / 2 - (((columns-f_height +1)-f_height1 +1)-f_height2 +1)*(((rows-f_width+1)-f_width1+1)-f_width2+1)*30/2)) + (30 * j) + "px";
    boxes.appendChild(box);
  }
  }

  for (let j = 0; j < outputNumber; j++) {
    var box = document.createElement("div");
    box.classList.add("box");
    box.id = "box1_" + j;
    box.style.borderRadius = "50%";
    box.style.width = 20 + "px";
    box.style.height = 20 + "px";
    box.style.left = (window.innerWidth /1.4) + "px";
    box.style.top = ((window.innerHeight / 2- outputNumber * 30/2) + (30 * j)) + "px";
    boxes.appendChild(box);
  }

  for (let j = 0; j < outputNumber; j++) {
    var box = document.createElement("div");
    box.classList.add("box");
    box.id = "box2_" + j;
    box.style.borderRadius = "50%";
    box.style.width = 20 + "px";
    box.style.height = 20 + "px";
    box.style.left = (window.innerWidth /1.2) + "px";
    box.style.top = ((window.innerHeight / 2- outputNumber * 30/2) + (30 * j)) + "px";
    boxes.appendChild(box);
  }

  for(let c = 0; c < outputNumber; c++){
      for(let d = 0; d < (((columns-f_height +1)-f_height1 +1)-f_height2 +1)*(((rows-f_width+1)-f_width1+1)-f_width2+1); d++){
                  let box2_1 = document.getElementById("box_" + d);
                  let box3_1 = document.getElementById("box1_" + c);
                  var line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                  line.setAttribute("x1", box2_1.offsetLeft + box2_1.offsetWidth/2);
                  line.setAttribute("y1", box2_1.offsetTop + box2_1.offsetHeight/2);
                  line.setAttribute("x2", box3_1.offsetLeft + box3_1.offsetWidth/2);
                  line.setAttribute("y2", box3_1.offsetTop + box3_1.offsetHeight/2);
                  line.style.stroke = "black";
                  line.style.strokeWidth = "2px";
                  svg.appendChild(line);
          }
        }
        document.getElementById("svgContainer").appendChild(svg);


for(let c = 0; c < outputNumber; c++){
      for(let d = 0; d < outputNumber; d++){
                  let box2_1 = document.getElementById("box1_" + d);
                  let box3_1 = document.getElementById("box2_" + c);
                  var line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                  line.setAttribute("x1", box2_1.offsetLeft + box2_1.offsetWidth/2);
                  line.setAttribute("y1", box2_1.offsetTop + box2_1.offsetHeight/2);
                  line.setAttribute("x2", box3_1.offsetLeft + box3_1.offsetWidth/2);
                  line.setAttribute("y2", box3_1.offsetTop + box3_1.offsetHeight/2);
                  line.style.stroke = "black";
                  line.style.strokeWidth = "2px";
                  svg.appendChild(line);
          }
        }
        document.getElementById("svgContainer").appendChild(svg);

      var buttons = document.querySelectorAll('.hidden');
      for (var i = 0; i < buttons.length; i++) {
      buttons[i].classList.remove('hidden');
  };
}



window.onresize = function() {
    svg = document.querySelector("svg");
    if (svg) {
      svg.parentNode.removeChild(svg);
    }
    createBoxes();
}
const zoomElement = document.querySelector(".container");
let zoom = 1;
const ZOOM_SPEED = 0.1;
const MIN_ZOOM = 0.5;
const MAX_ZOOM = 1;

document.addEventListener("wheel", function (e) {
  if (e.deltaY > 0 && zoom < MAX_ZOOM) {
    zoomElement.style.transform = `scale(${(zoom += ZOOM_SPEED)})`;
  } else if (e.deltaY < 0 && zoom > MIN_ZOOM) {
    zoomElement.style.transform = `scale(${(zoom -= ZOOM_SPEED)})`;
  }
});

let initialDistance;
let currentZoom = 1;

zoomElement.addEventListener('touchstart', function (e) {
  if (e.touches.length === 2) {
    initialDistance = getDistance(e.touches[0], e.touches[1]);
  }
});

zoomElement.addEventListener('touchmove', function (e) {
  if (e.touches.length === 2) {
    const currentDistance = getDistance(e.touches[0], e.touches[1]);
    const zoomDelta = currentDistance / initialDistance;
    currentZoom = Math.min(MAX_ZOOM, Math.max(MIN_ZOOM, currentZoom * zoomDelta));
    zoomElement.style.transform = `scale(${currentZoom})`;
  }
});

function getDistance(touch1, touch2) {
  const xDiff = touch1.clientX - touch2.clientX;
  const yDiff = touch1.clientY - touch2.clientY;
  return Math.sqrt(xDiff * xDiff + yDiff * yDiff);
}
      </script>
</head>
<body>
 
    <div class="container-fluid">
        <div class="row">
            <div class="nn-picker">
                <div class="card">
                    <div class="card-header">
                        <button class="btn btn-secondary btn-remove input-group-prepend pull-right" data-toggle="collapse" href="#collapsable" onclick="createBoxes_time()">Open/Fold</button>
                        <button class="btn btn-secondary btn-remove input-group-prepend" onclick="location.href='index.html'" >Back Main</button>
                    </div>
                    <div class="tab-content collapse show" id="collapsable">
                        <div class="tab-pane fade show active" id="FCNN" role="tabpanel">
                            <h4>Feature_map_3D</h4>

                            <hr>
                            <div id="architecture">

                                <div class="row entry">
                                    <span class="input-group mb-2 mr-sm-2 col-4">
                                        배열 크기<br>
                                        rows : <input type="number" id="inputNumber0" placeholder="Enter a number">
                                        columns : <input type="number" id="inputNumber1" placeholder="Enter a number">
                                        depths : <input type="number" id="inputNumber2" placeholder="Enter a number">

                                        필터 크기<br>
                                        rows : <input type="number" id="FilterNumber0" placeholder="Enter a number">
                                        columns : <input type="number" id="FilterNumber1" placeholder="Enter a number">
                                        count : <input type="number" id="FilterNumber2" placeholder="Enter a number"></input>

                                        필터 크기<br>
                                        rows : <input type="number" id="FilterNumber1_0" placeholder="Enter a number">
                                        columns : <input type="number" id="FilterNumber1_1" placeholder="Enter a number">
                                        count : <input type="number" id="FilterNumber1_2" placeholder="Enter a number"></input>

                                        필터 크기<br>
                                        rows : <input type="number" id="FilterNumber2_0" placeholder="Enter a number">
                                        columns : <input type="number" id="FilterNumber2_1" placeholder="Enter a number">
                                        count : <input type="number" id="FilterNumber2_2" placeholder="Enter a number"></input>

                                        노드 개수<br>
                                        크기 : <input type="number" id="outputNumber"  name="outputNumber" placeholder="Enter a number">
                                        <!--
                                        크기 : <input type="number" id="outputNumber"  name="outputNumber" placeholder="Enter a number">
                                        크기 : <input type="number" id="outputNumber"  name="outputNumber" placeholder="Enter a number">
                                        크기 : <input type="number" id="outputNumber"  name="outputNumber" placeholder="Enter a number">
                                        -->
                                        <br><button class="btn btn-primary btn-add input-group-prepend" onclick="createBoxes()">Create</button>
                                    </span>

                                    </div>
                                </div>
                                
                                </div>

                            </div>

                            <hr>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container" draggable="true">

    <div id="boxes"></div>
    <div id="svgContainer"></div>
    <button class="special hidden" onclick="location.href='Feature_map_2D.html'">Feature_map_2D</button>
    <button class="special1 hidden" onclick="location.href='Flat_View.html'">Flat_View</button>
    <button class="special2 hidden" onclick="location.href='2D_to_1D.html'">Flatten</button>
    <button class="special3 hidden" onclick="location.href='Feature_map.html'">Flatten_Circle</button>
    <button class="special4 hidden" onclick="location.href='ANN.html'">MLP</button>
    </div>
      
      <div id="count"><span></span></div>
      </a>


</body>

<script type="text/javascript" src="Feature_map_3D/js/jquery-3.2.1.slim.min.js" ></script>
<script type="text/javascript" src="Feature_map_3D/js/popper.min.js"></script>
<script type="text/javascript" src="Feature_map_3D/js/bootstrap.min.js"></script>

<script type="text/javascript" src="Feature_map_3D/js/d3.v5.min.js"></script>
<script type="text/javascript" src="Feature_map_3D/js/util.js"></script>
<script type="text/javascript" src="Feature_map_3D/js/Feature_map_3D.js" ></script>

</html>
